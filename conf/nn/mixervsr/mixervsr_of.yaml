data:
  _target_: vsr.data.datamodule.DataModuleVSR
  datasets:
    train:
      _target_: vsr.data.dataset.DatasetVSR
      path: "/home/aghinassi/hdd/vsr/REDS"
      split: "train"
      seq: 15
      scale: 4
      size: 0.9
      hr_augmentation:
        - _target_: kornia.augmentation.RandomCrop
          size: [ 512, 512 ]
          pad_if_needed: True
          same_on_batch: True
          keepdim: True

        - _target_: kornia.augmentation.Resize
          size: [ 256, 256 ]
          keepdim: True

        - _target_: kornia.augmentation.RandomHorizontalFlip
          p: 0.5
          same_on_batch: True
          keepdim: True

        - _target_: kornia.augmentation.RandomVerticalFlip
          p: 0.5
          same_on_batch: True
          keepdim: True

      lr_augmentation:
        - _target_: kornia.augmentation.RandomGaussianBlur
          kernel_size: 7
          sigma: [ 0.2, 3 ]
          same_on_batch: False
          p: 0.8
          keepdim: True

        - _target_: kornia.augmentation.ColorJitter
          p: 0.5
          brightness: 0.05
          contrast: 0.05
          saturation: 0.05
          hue: 0.05
          same_on_batch: False
          keepdim: True

        - _target_: core.augmentations.RandomJPEGCompression
          quality: [ 30, 90 ]

        - _target_: kornia.augmentation.RandomGaussianBlur
          kernel_size: 9
          sigma: [ 0.2, 3 ]
          same_on_batch: False
          keepdim: True
          p: 0.8

        - _target_: kornia.augmentation.RandomGaussianNoise
          mean: 0
          std: 0.03
          same_on_batch: False
          keepdim: True
          p: 0.7

        - _target_: kornia.augmentation.RandomGaussianBlur
          kernel_size: 5
          sigma: [ 0.2, 3 ]
          same_on_batch: False
          keepdim: True
          p: 0.7

        - _target_: core.augmentations.RandomJPEGCompression
          quality: [ 30, 70 ]

        - _target_: core.augmentations.RandomVideoCompression
          codec: [ 'libx264', 'h264', 'mpeg4' ]
          crf: [ 30, 40 ]
          fps: [ 15, 30 ]

        - _target_: kornia.augmentation.Resize
          size: [ 64, 64 ]

    val:
      _target_: vsr.data.dataset.DatasetVSR
      path: "/home/aghinassi/hdd/vsr/REDS"
      split: "val"
      seq: 15
      scale: 4
      size: 0.1
      hr_augmentation:
        - _target_: kornia.augmentation.RandomCrop
          size: [ 512, 512 ]
          pad_if_needed: True
          same_on_batch: True
          keepdim: True

        - _target_: kornia.augmentation.Resize
          keepdim: True
          size: [ 256, 256 ]

      lr_augmentation:
        - _target_: kornia.augmentation.RandomGaussianBlur
          kernel_size: 5
          keepdim: True
          sigma: [ 0.2, 3 ]
          same_on_batch: True
          p: 0.7

        - _target_: core.augmentations.RandomVideoCompression
          codec: [ 'libx264', 'h264', 'mpeg4' ]
          crf: [ 30, 40 ]
          fps: [ 15, 30 ]

        - _target_: kornia.augmentation.Resize
          size: [ 64, 64 ]

  num_workers: 16

  batch_size: 4

  prefetch_factor: 4

module:
  _target_: vsr.pl_module.pl_module.LitRealVSR
  model:
    _target_: vsr.modules.mixervsr.MixerVSR
    img_size: [ 64, 64 ]
    steps: 3
    mid_ch: 64
    it_blocks: 15
    patch_size: 8
    time_dim: 15
    exp: 2
    mix_blocks: 15
    conv_blocks: 15
    upscale: ${nn.data.data.train.scale}

  loss:
    _target_: core.losses.WL1Loss
    weight: 1.0

  of_loss:
    _target_: core.losses.OpticalFlowConsistency
    weight: 1.0
    model:
      _target_: optical_flow.modules.pwcnet.PWCNet
      md: 4
      pretrained: ${oc.env:PROJECT_ROOT}/src/optical_flow/weights/pwc_net.pth.tar

  metric:
    _target_: core.metrics.MetricCollection
    metrics:
      PSNR:
        _target_: piqa.PSNR
      SSIM:
        _target_: piqa.SSIM

  optimizer:
    _target_: deepspeed.ops.adam.DeepSpeedCPUAdam
    lr: 1e-4
    betas: [ 0.9, 0.999 ]
    eps: 1e-08
    weight_decay: 0

  scheduler:
    _target_: torch.optim.lr_scheduler.CosineAnnealingLR
    T_max: ${train.trainer.max_epochs}
    eta_min: 1e-6
    verbose: False

  log_interval: 250
  log_k_images: 5


